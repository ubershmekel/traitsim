<html>
<head>
    <title>TraitSim</title>
    <meta name="Description" content="Recessive and dominant trait simulator" />
    <!--meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"-->
    <style>
        body {
            background-color:#eee;
            min-width: 500px;
            margin: auto;
        }
        .main_link {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 3px;
            border-top: 1px solid #eee;
        }
        #myCanvas {
            z-index: -9999;
            background-color: #000;
        }
    </style>
    
    <link rel="shortcut icon" href="key_y.png" />
    
</head>
<body>
    <canvas id="myCanvas" resize="true"></canvas>
    
    <script src="http://cdnjs.cloudflare.com/ajax/libs/paper.js/0.22/paper.js"></script>
    <script type="text/paperscript" canvas="myCanvas">
    var BLUE = {
        name: 'blue',
        color: '#29f',
        isDominant: false
        };
    var BROWN = {
        name: 'brown',
        color: '#930',
        isDominant: true
        };
    
    var GENE_HEIGHT = 10;
    var GENE_WIDTH = 20;
    var GENE_SPACING = 5;
    var MARGIN = view.size.width / 10;
    var initAmount = 100;

    function shuffle(list) {
    //shuffles list in-place
        var i, j, t;
        for (i = 1; i < list.length; i++) {
            // choose j in [0..i]
            j = Math.floor(Math.random() * (1 + i));
            if (j != i) {
                // swap list[i] and list[j]
                t = list[i];
                list[i] = list[j];
                list[j] = t;
            }
        }
    }
    
    function dominanceSort(gene_a, gene_b) {
        return gene_a.isDominant;
    }
    
    function initGene(gene, pos) {
        var path = new Path();
        path.add(pos);
        path.add(pos + [0, GENE_HEIGHT]);
        //var path = new Path.Rectangle(rects[i]);
        path.style = {
            strokeColor: gene.color,
            strokeWidth: GENE_WIDTH,
            strokeCap: 'round'
        };
        return path;
    }
    
    function initPerson(genes, pos) {
        var paths = []
        if(genes.length == 0) {
            throw "Bad person with no genes";
        }
        
        genes.sort(dominanceSort);
        
        for(var i = 0; i < genes.length; i++) {
            paths[i] = initGene(genes[i], pos + [i * GENE_SPACING, 0]);
        }
        
        var group = new Group(paths);
        return group;
    }

    // init gene pool
    var genePool = []
    for (var i = 0; i < initAmount; i++) {
        genePool[2 * i] = BLUE;
        genePool[2 * i + 1] = BROWN;
    }
    shuffle(genePool);
    
    function initPeople() {
        var width = view.size.width;
        var height = view.size.height;
        var people = []
        for (var i = 0; i < initAmount; i++) {
            var genes = [genePool[2 * i], genePool[2 * i + 1]];
            var pos = new Point(Math.random() * (width - 2 * MARGIN) + MARGIN, Math.random() * (height - 2 * MARGIN) + MARGIN);
            var personPath = initPerson(genes, pos);
            people[i] = {
                        genes: genes,
                        path: personPath
                        }
        }
        return people;
    }
    var people = initPeople();

    function initUI() {
        messages = ["TraitSim", 'Simulate recessive and dominant gene demographics', "Click anywhere for sex"];
        for(var i = 0; i < messages.length; i++) {
            var text = new PointText([view.size.width / 2, 25 + i * 25]);
            text.justification = 'center';
            text.fillColor = 'white';
            text.content = messages[i];
            text.fontSize = 15;
        }
    }
    initUI();
    
    
    
    function onFrame(event) {
        for (var i = 0; i < people.length; i++) {
            people[i].path.translate(new Point(Math.random() * 1 - 0.5, Math.random() * 1 - 0.5));
        }
    }
    
    function onMouseDown(event) {
    }

    function onMouseUp(event) {
    }
</script>
</body>
</html>
