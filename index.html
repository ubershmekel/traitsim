<html>
<head>
    <title>TraitSim</title>
    <meta name="Description" content="Recessive and dominant trait simulator" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"-->
    <style>
        /* this needs to come before bootstrap css so it reacts  correctly
            and doesn't create a gap above the navbar on small windows */
        body {
            padding-top: 50px;
        }
    </style>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.1.1/css/bootstrap-combined.min.css" rel="stylesheet" />
    <style>
        body {
            background-color:#eee;
            min-width: 240px;
        }
        .main_link {
            background-color: #fff;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            border-top: 1px solid #eee;
        }
        #myCanvas {
            position: absolute;
            z-index: -9999;
        }
    </style>
    
    <link rel="shortcut icon" href="key_y.png" />
    
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container">
                <a href="" class="brand">TraitSim</a>
            </div>
        </div>
    </div>
    <div class="container">
        <canvas id="myCanvas" resize="true"></canvas>
        <div class="span4 main_link">
             Simulating passive and recessive gene demographics.
            <h2 style="color: #2bf;">Blue eyed genes</h2>
            <p>100</p>
        </div>
        <div class="span4 main_link">
            <h2 style="color: #a31;">Brown eyed genes</h2>
            <p>100</p>
        </div>
    </div>
    
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.1.1/bootstrap.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/paper.js/0.22/paper.js"></script>
    <script type="text/paperscript" canvas="myCanvas">
    var BLUE = {
        name: 'blue',
        color: '#2bf',
        isDominant: false
        };
    var BROWN = {
        name: 'brown',
        color: '#a40',
        isDominant: true
        };
    
    var GENE_HEIGHT = 10;
    var GENE_WIDTH = 20;
    var GENE_SPACING = 5;
    var initAmount = 100;

    function shuffle(list) {
    //shuffles list in-place
        var i, j, t;
        for (i = 1; i < list.length; i++) {
            // choose j in [0..i]
            j = Math.floor(Math.random() * (1 + i));
            if (j != i) {
                // swap list[i] and list[j]
                t = list[i];
                list[i] = list[j];
                list[j] = t;
            }
        }
    }
    
    function dominanceSort(gene_a, gene_b) {
        return gene_a.isDominant;
    }
    
    function initGene(gene, pos) {
        var path = new Path();
        path.add(pos);
        path.add(pos + [0, GENE_HEIGHT]);
        //var path = new Path.Rectangle(rects[i]);
        path.style = {
            strokeColor: gene.color,
            strokeWidth: GENE_WIDTH,
            strokeCap: 'round'
        };
        return path;
    }
    
    function initPerson(genes, pos) {
        var paths = []
        if(genes.length == 0) {
            throw "Bad person with no genes";
        }
        
        genes.sort(dominanceSort);
        
        for(var i = 0; i < genes.length; i++) {
            paths[i] = initGene(genes[i], pos + [i * GENE_SPACING, 0]);
        }
        
        var group = new Group(paths);
        return group;
    }
    
    var people = [];
    var person = [BLUE, BROWN];
    var genes = []

    // init gene pool
    for (var i = 0; i < initAmount; i++) {
        genes[2 * i] = BLUE;
        genes[2 * i + 1] = BROWN;
    }
    
    shuffle(genes);
    
    var rects = []
    var paths = []
    var rectSize = new Size(10, 10);
    var r = new Rectangle(new Point(0,0), rectSize);
    for (var i = 0; i < initAmount; i++) {
        people[i] = {
                    genes: [genes[2 * i], genes[2 * i + 1]],
                    }
        //r.x = people[i].pos.x
        //r.y = people[i].pos.y
        var pos = view.center + new Point(Math.random() * 300 - 150, Math.random() * 300 - 150);
        var path = initPerson(people[i].genes, pos);
        
        paths[i] = path;
    }

    function onFrame(event) {
        for (var i = 0; i < paths.length; i++) {
            paths[i].translate(new Point(Math.random() * 1 - 0.5, Math.random() * 1 - 0.5));
        }
    }
    
    function onMouseDown(event) {
        path.fullySelected = true;
        path.strokeColor = '#e08285';
    }

    function onMouseUp(event) {
        path.selected = false;
        path.strokeColor = '#1414eb';
    }
</script>
</body>
</html>
